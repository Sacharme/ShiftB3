<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-Copilot — Tableau de Bord Écologique | Métropole de Lyon</title>
  <meta name="description"
    content="Outil d'aide au pilotage pour la transition énergétique de la Métropole de Lyon. Visualisation des données écologiques des infrastructures publiques." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/src/styles/index.css" />
  <link rel="stylesheet" href="/src/styles/views.css" />
</head>

<body>
  <!-- HEADER -->
  <header id="app-header">
    <div class="header-left">
      <div class="logo">
        <svg viewBox="0 0 32 32" width="32" height="32" fill="none">
          <circle cx="16" cy="16" r="14" stroke="url(#grad)" stroke-width="2.5" />
          <path d="M10 20 L16 10 L22 20 Z" fill="url(#grad)" opacity="0.8" />
          <path d="M13 18 L16 12 L19 18" stroke="rgba(255,255,255,0.9)" stroke-width="1.5" fill="none" />
          <defs>
            <linearGradient id="grad" x1="0" y1="0" x2="32" y2="32">
              <stop offset="0%" stop-color="#34d399" />
              <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
          </defs>
        </svg>
        <h1>E-Copilot</h1>
      </div>
      <span class="header-subtitle">Transition Énergétique — Métropole de Lyon</span>
    </div>
    <div class="header-center">
      <nav id="main-nav">
        <button class="nav-btn active" data-view="visualization" id="nav-visualization">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="12" width="4" height="9" rx="1" />
            <rect x="10" y="7" width="4" height="14" rx="1" />
            <rect x="17" y="3" width="4" height="18" rx="1" />
          </svg>
          <span>Visualisation</span>
        </button>
        <button class="nav-btn" data-view="datatable" id="nav-datatable">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" />
            <line x1="3" y1="9" x2="21" y2="9" />
            <line x1="3" y1="15" x2="21" y2="15" />
            <line x1="9" y1="3" x2="9" y2="21" />
          </svg>
          <span>Données</span>
        </button>
        <button class="nav-btn" data-view="cartography" id="nav-cartography">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4z" />
            <line x1="8" y1="2" x2="8" y2="18" />
            <line x1="16" y1="6" x2="16" y2="22" />
          </svg>
          <span>Cartographie</span>
        </button>
      </nav>
    </div>
    <div class="header-right">
      <div class="etl-status" id="etl-status">
        <span class="status-dot"></span>
        <span class="status-text">En attente</span>
      </div>
      <button class="refresh-btn" id="refresh-btn" title="Lancer le pipeline ETL (IA Copilot)">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10" />
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
        </svg>
      </button>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main id="app-main">
    <!-- VUE 1: VISUALIZATION -->
    <section id="view-visualization" class="view active">
      <div class="viz-layout">
        <div class="chart-area" id="chart-area">
          <div class="chart-placeholder" id="chart-placeholder">
            <svg viewBox="0 0 80 80" width="80" height="80" fill="none" stroke="rgba(255,255,255,0.15)"
              stroke-width="2">
              <rect x="8" y="40" width="12" height="32" rx="3" />
              <rect x="24" y="28" width="12" height="44" rx="3" />
              <rect x="40" y="16" width="12" height="56" rx="3" />
              <rect x="56" y="8" width="12" height="64" rx="3" />
            </svg>
            <p>Lancez le pipeline ETL puis configurez votre graphique</p>
          </div>
          <canvas id="main-chart"></canvas>
        </div>
        <aside class="side-panel" id="side-panel">
          <div class="panel-section">
            <h3 class="panel-title">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="12" width="4" height="9" rx="1" />
                <rect x="10" y="7" width="4" height="14" rx="1" />
                <rect x="17" y="3" width="4" height="18" rx="1" />
              </svg>
              Graphiques
            </h3>
            <div class="chart-type-grid" id="chart-type-grid">
              <button class="chart-type-card active" data-type="bar" title="Barres">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="4" y="20" width="8" height="16" rx="2" />
                  <rect x="16" y="10" width="8" height="26" rx="2" />
                  <rect x="28" y="14" width="8" height="22" rx="2" />
                </svg>
                <span>Barres</span>
              </button>
              <button class="chart-type-card" data-type="line" title="Courbes">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="4,32 14,18 24,24 36,8" />
                  <circle cx="4" cy="32" r="2" fill="currentColor" />
                  <circle cx="14" cy="18" r="2" fill="currentColor" />
                  <circle cx="24" cy="24" r="2" fill="currentColor" />
                  <circle cx="36" cy="8" r="2" fill="currentColor" />
                </svg>
                <span>Courbes</span>
              </button>
              <button class="chart-type-card" data-type="scatter" title="Nuage de points">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="8" cy="28" r="3" fill="currentColor" />
                  <circle cx="16" cy="14" r="3" fill="currentColor" />
                  <circle cx="26" cy="22" r="3" fill="currentColor" />
                  <circle cx="34" cy="10" r="3" fill="currentColor" />
                  <circle cx="20" cy="32" r="3" fill="currentColor" />
                </svg>
                <span>Points</span>
              </button>
              <button class="chart-type-card" data-type="pie" title="Secteurs">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="20" cy="20" r="14" />
                  <path d="M20 6 L20 20 L32 14" stroke="currentColor" />
                  <line x1="20" y1="20" x2="8" y2="28" />
                </svg>
                <span>Secteurs</span>
              </button>
              <button class="chart-type-card" data-type="doughnut" title="Anneau">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="3">
                  <circle cx="20" cy="20" r="12" />
                  <path d="M20 8 A12 12 0 0 1 32 20" stroke="currentColor" stroke-width="4" />
                </svg>
                <span>Anneau</span>
              </button>
              <button class="chart-type-card" data-type="radar" title="Radar">
                <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="1.5">
                  <polygon points="20,4 35,14 32,32 8,32 5,14" />
                  <polygon points="20,12 28,17 26,28 14,28 12,17" opacity="0.5" />
                  <line x1="20" y1="4" x2="20" y2="20" />
                  <line x1="35" y1="14" x2="20" y2="20" />
                  <line x1="5" y1="14" x2="20" y2="20" />
                </svg>
                <span>Radar</span>
              </button>
            </div>
          </div>
          <div class="panel-section">
            <h3 class="panel-title">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3" />
                <path
                  d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83" />
              </svg>
              Données
            </h3>
            <div class="data-form" id="data-form">
              <div class="form-group">
                <label for="x-axis-data">Données Axe X</label>
                <select id="x-axis-data" disabled>
                  <option value="">— Lancer ETL —</option>
                </select>
              </div>
              <div class="form-group">
                <label for="y-axis-data">Données Axe Y</label>
                <select id="y-axis-data" disabled>
                  <option value="">— Lancer ETL —</option>
                </select>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="x-axis-label">Nom Axe X</label>
                  <input type="text" id="x-axis-label" placeholder="Axe X" disabled />
                </div>
                <div class="form-group">
                  <label for="y-axis-label">Nom Axe Y</label>
                  <input type="text" id="y-axis-label" placeholder="Axe Y" disabled />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="x-axis-color">Couleur X</label>
                  <div class="color-input-wrapper">
                    <input type="color" id="x-axis-color" value="#34d399" disabled />
                    <span class="color-hex" id="x-color-hex">#34d399</span>
                  </div>
                </div>
                <div class="form-group">
                  <label for="y-axis-color">Couleur Y</label>
                  <div class="color-input-wrapper">
                    <input type="color" id="y-axis-color" value="#06b6d4" disabled />
                    <span class="color-hex" id="y-color-hex">#06b6d4</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <!-- VUE 2: DATA TABLE -->
    <section id="view-datatable" class="view">
      <div class="table-header">
        <h2>Données Traitées</h2>
        <div class="table-controls">
          <div class="search-wrapper">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8" />
              <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <input type="text" id="table-search" placeholder="Rechercher..." />
          </div>
          <button class="control-btn" id="btn-export" title="Exporter en CSV">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Exporter</span>
          </button>
          <span class="record-count" id="record-count">0 enregistrements</span>
        </div>
      </div>
      <div class="table-container" id="table-container">
        <div class="table-placeholder">
          <p>Lancez le pipeline ETL pour afficher les données</p>
        </div>
      </div>
    </section>

    <!-- VUE 3: CARTOGRAPHY -->
    <section id="view-cartography" class="view">
      <div id="map-container"></div>
      <div class="map-legend" id="map-legend">
        <h4>Légende</h4>
        <div class="legend-item"><span class="legend-dot" style="background:#34d399"></span> Faible consommation</div>
        <div class="legend-item"><span class="legend-dot" style="background:#fbbf24"></span> Consommation moyenne</div>
        <div class="legend-item"><span class="legend-dot" style="background:#ef4444"></span> Forte consommation</div>
      </div>
    </section>
  </main>

  <script type="module" src="/src/main.js"></script>
</body>

</html>